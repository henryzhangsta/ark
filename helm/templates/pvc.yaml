{{- $root := . -}}

{{- range $name := (ternary (list "server" "config" "cluster") (list "server" "config") .Values.cluster.enabled) }}
{{- $volume := index $root.Values.volumes $name }}
{{- if $volume.createClaim }}
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: {{ include "ark.volumeName" (dict "Values" $root.Values "Chart" $root.Chart "Release" $root.Release "name" $name "shared" $volume.shared) }}
  labels:
    app.kubernetes.io/name: {{ include "ark.name" $root }}
spec:
  storageClassName: {{ $volume.storageClassName }}
  volumeMode: Filesystem
  accessModes:
  - {{ $volume.accessMode }}
  resources:
    requests:
      storage: {{ $volume.capacity }}
{{- end }}
{{- end }}
